# 2026年 1月 学習ログ

## 2026-01-28

### 取り組んだこと
- LED点灯
- Lチカ
- チャタリング(プログラムの工夫だけは行ったが、ハードウェアの工夫はシュミットトリガーがないので今度)
- 可変抵抗(キットに可変抵抗が無かったのでまた今度)
- プルアップ抵抗・プルダウン抵抗

### 学んだこと・メモ

#### チャタリング
金属板を端子に付ける際、金属板が金属板と接続されるまで、金属板と金属板が接続されている状態になることを**チャタリング**という。チャタリングを回避するには、**プログラムの工夫**と**ハードウェアの工夫**がある。

1. プログラムの工夫

チャタリングはごく短い時間に発生させるので、チャタリングが起こっている間は、一時的に待機させる。
```cpp
if (digitalRead(SWITCH_SOCKET) == 1){
    delay(100);
    count = count + 1;
}
```
2. チャタリング防止回路

待機する時間が長かったりする場合は、チャタリング防止回路をスイッチの出力後に作成しておく。

![チャタリング防止回路](images/チャタリング防止回路.png)

![チャタリング発生時の各点の電圧変化](images/チャタリング発生時の各点の電圧変化.png)

抵抗は**急激に電荷が流れるのを阻止**する。コンデンサは**電圧の変化を緩やかにする特性**がある。この2つの特性により、チャタリングが発生している部分を影響がない状態にできる。

チャタリングが終わった後は、抵抗とコンデンサの影響で電圧が緩やかにVddになってしまう。そこで、**シュミットトリガー**と呼ばれるICを利用することで出力を0からVddへ急激に切り替えることが可能になる。図の74LS14と74HC14は、インバータが実装されているため、2つ通すことで正しい出力が得られる。

#### 可変抵抗
可変抵抗には、つまみを付けて自由に変化できる**ボリューム**と一度調節したら通常は抵抗値を変えない**半固定抵抗**の2種類がある。
可変抵抗には3つの端子があり、そのうち2つの端子は抵抗素子の両端に接続されている。つまり、両端の端子間は**ボリュームの最大抵抗値**を表す。もう1つの端子は、抵抗素子場を動かせるようになっている。この抵抗素子場を動かすことで、抵抗値を変更することができる。

#### 危険な回路
1. オープン回路
![オープン回路](images/オープン回路.png)

ボダンがOFFのとき、完全に**インプットピンが宙ぶらりん**になってしまう。

2. 短絡回路
![短絡回路](images/短絡回路.png)

これは大事故につながってしまう。ボタンにかかっていく電圧とインプットピンにかかる電圧は等しい。**ボタンの抵抗値は0に等しいのでショート回路**となる。

#### プルアップ回路
デジタル入力ピンは、内部抵抗が極めて高いため、どこにも接続されていないと周辺のわずかなノイズに反応して電位が激しく変動し、**フローティング状態**となる。これを避けるために、**プルアップ回路**を構成する。

![プルアップ回路](images/プルアップ回路.png)

**インプットピンを抵抗を介してVCC側に接続する**構成。スイッチはピンとGNDの間に配置される。

1. スイッチが**OFF**のとき

**入力ピンの内部抵抗は極めて高い**ため、回路全体の電流は0に等しい。

電流がほぼ0であるため、プルアップ抵抗での電圧降下もほぼ0となり、**入力ピンに印加される電圧は電源電圧とほぼ等しく**なり、ピンは**HIGH**状態で安定する。

2. スイッチが**ON**のとき

インプットピンが直接GNDに接続される。電流は電源から抵抗を通り、スイッチを経由してGNDへと流れる。このとき、ピンの電位はGNDと等しくなるため、ピンは**LOW**状態で安定する。

## 2026-01-29
### 取り組んだこと
- モーター制御
- サーボモーターの制御
- 超音波センサ

### 学んだこと・メモ

#### モーター制御
**PWM**は疑似的にアナログ出力が可能。0Vと5Vを高速で切り替えることで、0Vと5Vの間の電圧を作り出すことが出来る。例えば、3Vの電圧を得たい場合、5Vの時間を3、0Vの時間を2の割合で出力するようにする。

モーターを制御する場合は、Arduinoのデジタル出力のソケットに直接つないではいけない。モーターを駆動するには、比較的大きな電流が流れなければならないので、**モーター制御用IC**を使用する。

#### サーボモーターの制御
サーボモーターは**特定の角度まで回転しその状態を保持する動作**をする。サーボモーターの目的の角度は**パルス幅**で決まる。

サーボモーターを制御するパルス幅は、どのメーカーでも似た決まりとなっている。
多くの場合、動作の中心が1.5msで、1度動かすごとに±0.1ms程度パルスを増減する。

![サーボモーターの接続端子](images/サーボモーターの接続端子.png)

サーボモーターには3つの導線がついている。赤は5V電源、茶色はGND、オレンジにはPWM信号を入力する。
PWM出力には、PD3,5,6,9,10,11のいずれかを使用する。

#### 超音波センサ
超音波センサは、超音波を発射して、反射波を拾うことで距離を測定する。

![HC-SR04](images/HC-SR04.png)

`T`と書いてある方がTransmit、`R`と書いてある方がReceiveを表す。端子は左からVCC,Trig,Echo,GNDの順で接続する。

多くの超音波センサは、10µs以上のTrigピンからのHIGH信号を受け取ると、超音波を発射する。その後`pulseIN`関数を使用してEchoピンを自動的にHIGHにし、LOWになるまで待つ。

### 次回の取り組み
モーターとサーボモーターに接続したとき、
```bash
avrdude: ser_open(): can't set com-state for "\\.\COM3"
```
というエラーが出た。

Surface Laptop5で実行したが、**PCのUSBポートから供給される電力で賄えなかった可能性**がある。電圧が不安定になったことで、Arduino上の通信チップがフリーズし、PC側からは通信が異常終了した。しかし、WindowsはCOM3ポートはまだ使用中だと認識し、他のプログラムがアクセスできないようにロックをかけたのだと考えられる。

対応策としては、**USBポートを変更する**か、**Arduinoの電源供給を外部電源に変更する**かを考える。

超音波センサでは、今回は室温条件下で測定したため、実測値との差は小さかったが、より精密に測定する場合、**温度計を併用して測定する必要がある**。

## 2026-01-30

### 取り組んだこと
- [有機ELキャラクタデバイス](/projects/displays/organic_el/organic_el.ino)
- Tinkercadの使い方を学んだ
- ブザー

### 学んだこと・メモ
#### 電圧が異なるデバイス間をつなぐとき
**レベルコンバータ**を使用する。3.3Vで動作するデバイスと5Vで動作するデバイスを接続する際に使用する。
#### Tinkercad
配線が複雑になってきた。Tinkercadでシミュレーションを行う。今回作った[LCDの接続](https://www.tinkercad.com/things/h5vjEc0jDTX/editel?returnTo=%2Fdashboard)を確認するのに役立った。
![tinkercadのLCD接続](images/tinkercadのLCD接続.png)
#### 有機ELキャラクタデバイス
1. 電源と表示の基本
- VSS : GND
- VDD : 5V
- V0 : 電源と文字の濃さを決める。**GNDに直結すると文字が最も濃く表示される**。**文字のコントラストを調整したい時は、ここに抵抗を入れるなりして調整する**。
- RW : Highで読み込み、Lowで書き込み。今回はArduinoから命令を書き込むだけなのでGNDに接続する
2. 通信の要
- RS : Arduinoが送るデータが**命令**なのか**文字**なのかを切り替えるスイッチ。Highで表示する文字、Lowで命令。
- E : データを読み込ませるための信号。Highで書き込み、Lowで読み込み。
- D0-D7 : **データをやり取りする8本の線**。今回は4bitモードで制御するので、D4-D7の4本を使用する。

#### ブザー
内部にコイルと金属板が入っており、**コイルにプラスマイナスの電圧を加えると金属板が振動し音を鳴らす**。

ブザーには**パッシブブザー**と**アクティブブザー**の2種類がある。
- アクティブブザー : 内部回路があり、DC電圧をかけるだけで決まった音を出していく。
- パッシブブザー : 内部の制御信号はなく、外からのパルス信号を入れることで音を出す。

![パッシブブザーの接続](images/パッシブブザーの接続.png)